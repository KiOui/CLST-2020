{% extends 'progbase.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}
Equestria: Upload
{% endblock %}

{% block prebody %}
{% include "pipeline.html" with active="upload" %}


<script>function uploadTXT(event) {
    event.preventDefault();
    var Form = new FormData($('TXTform'));
    var data = Form.get(0);
    $.ajax({
        url: $(this).attr('action'),
        type: $(this).attr('method'),
        data: data,
        cache: false,
        processData: false,
        contentType: false,
        success: function(data) {
            alert('success');
        }
    });
    return false;
    }
    
    $(function() {
        $('TXTform').submit(uploadTXT);
    });</script>
{% endblock %}

{% block body %}
    <div class="container-fluid">
        <div class="rounded shadow lighter padding">
            <h1>Upload files</h1>
            {% if upload_form %}
                <h3>Upload a file (.txt .tg or .wav):</h3>
                <form class="md-form" action="{% url 'upload:upload_file' project=project %}" method="post" enctype="multipart/form-data">
                    <div class="input-group mb-3">
                        <div class="custom-file">
                            {% crispy upload_form %}
                            {%csrf_token%}
                            <input type="submit" name="TXTform" value="Submit" class="btn btn-primary" id="upload-txt-btn">
                        </div>
                    </div>
                </form>
            {% endif %}
            {% if profile_form %}
                <form class="md-form" action="" method="post" enctype="multipart/form-data">
                    <div class="input-group mb-3">
                        <div class="custom-file">
                            {% crispy profile_form %}
                            {%csrf_token%}
                            <input type="submit" name="TXTform" value="Submit" class="btn btn-primary" id="upload-txt-btn">
                        </div>
                    </div>
                </form>
            {% else %}
                <p style="background-color: red;">There is currently a running process. You can not start a new process.
                    First wait for the current process to finish and reload this page.</p>
            {% endif %}
        </div>
    </div>
{% for file in  files %}
    <p> {{ file }} </p>
{% endfor %}
{% endblock %}
