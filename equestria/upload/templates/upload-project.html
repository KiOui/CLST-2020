{% extends 'progbase.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}
Equestria: Upload
{% endblock %}

{% block prebody %}
{% include "pipeline.html" with active="upload" %}


<script>
    $(document).ready ( function () {
        $("#ImageHosting").click(function (event) {
            event.preventDefault();
            var formData = new FormData($(this).attr('class'))
            console.log(formData);
            $.ajax({
                url: $(this).attr('action'),
                type: $(this).attr('method'),
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success: function(data) {
                    console.log("success");
        }
    });
        });
    });

    </script>
{% endblock %}

{% block body %}
    <div class="container-fluid">
        <div class="rounded shadow lighter padding">
            <h1>Upload files</h1>
            {% if upload_form %}
                <h3>Upload your files (.txt .tg .wav or .zip):</h3>
                <form class="md-form" action="{% url 'upload:upload_file' project=project %}" method="post" enctype="multipart/form-data">
                    <div class="input-group mb-3">
                        <div class="custom-file">
                            {% crispy upload_form %}
                            {%csrf_token%}
                            <input type="submit" id="ImageHosting" value="Upload files" class="btn btn-primary">
                        </div>
                    </div>
                </form>
            {% endif %}
            {% if can_start %}
                <form class="md-form" action="" method="post" enctype="multipart/form-data">
                    <div class="input-group mb-3">
                        <div class="custom-file">
                            {% csrf_token %}
                            <input type="submit" value="Continue" class="btn btn-primary">
                        </div>
                    </div>
                </form>
            {% else %}
                <p style="background-color: red;">There is currently a running process. You cannot start a new process.
                    First, wait for the current process to finish and reload this page.</p>
            {% endif %}
            {% if no_txt_list %}
                Warning! These .wav files do not have a corresponding .txt or .tg file: <br/>
                {% for file in no_txt_list %}
                    {{ file }}
                {% endfor %}
                <br/>
            {% endif %}
            {% if no_wav_list %}
                Warning! These .txt or .tg files do not have a corresponding .wav file: <br/>
                {% for file in no_wav_list %}
                {{  file }}
                {% endfor %}
            {% endif %}

        </div>
    </div>
    <br />
	<div class="container-fluid">
		<div class="rounded shadow lighter padding">
            {% if files %}
                {% for file in  files %}
                    <p> {{ file }} </p>
                {% endfor %}
            {% else %}
                <p> No files have been uploaded yet </p>
            {% endif %}
		</div>
	</div>
{% endblock %}
